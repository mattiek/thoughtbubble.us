</html>

{% extends 'base.html'%}
{% block head %}
    <link rel="stylesheet" href="{{ STATIC_URL }}css/magnific-popup.css"/>
    <link rel="stylesheet" href="{{ STATIC_URL }}css/checkout.css"/>
    <style type="text/css">

    </style>
    <script type="text/javascript" src="https://js.balancedpayments.com/v1/balanced.js"></script>
    <script type="text/javascript">
        balanced.init('{{ balanced.MARKETPLACE_URI }}');
    </script>
{% endblock %}

{% block content %}
    <div id="errors">

    </div>
    <form id="credit-card-form" role="form" class="form-horizontal">
        <div class="form-group">
            <label class="col-lg-5 control-label">Card Number</label>
            <div class="col-lg-5">
                <input type="text" id="cc-number" class="form-control" autocomplete="off" placeholder="4111111111111111" maxlength="16" />
            </div>
        </div>
        <div class="form-group">
            <label class="col-lg-5 control-label">Expiration</label>
            <div class="col-lg-2">
                <input type="text" id="cc-ex-month" class="form-control" autocomplete="off" placeholder="01" maxlength="2" />
            </div>
            <div class="col-lg-2">
                <input type="text" id="cc-ex-year" class="form-control" autocomplete="off" placeholder="2013" maxlength="4" />
            </div>
        </div>
        <div class="form-group">
            <label class="col-lg-5 control-label">Billing Zip Code</label>
            <div class="col-lg-2">
                <input type="text" id="cc-zip" class="form-control" autocomplete="off" placeholder="12345" maxlength="5" />
            </div>
        </div>
        <div class="form-group">
            <label class="col-lg-5 control-label">Security Code (CSC)</label>
            <div class="col-lg-2">
                <input type="text" id="ex-csc" class="form-control" autocomplete="off" placeholder="453" maxlength="4" />
            </div>
        </div>
        <a id="cc-submit" class="btn btn-large btn-primary pull-right">Submit Credit Info</a>
    </form>

    <form id="post_checkout" action="{% url 'post_checkout' %}" method="POST">
        {% csrf_token %}
    </form>


{% endblock %}


{% block footerscripts %}
    <script type="text/javascript">
        // Generated by CoffeeScript 1.6.3
        var callbackHandler;

        callbackHandler = function(response) {
            var $form, cardTokenURI;
            switch (response.status) {
                case 201:
                    console.log(response.data);
                    $form = $("#post_checkout");
                    cardTokenURI = response.data['uri'];
                    $('<input>').attr({
                        type: 'hidden',
                        value: cardTokenURI,
                        name: 'balancedCreditCardURI'
                    }).appendTo($form);
                    return $form.submit();
                case 400:
                    $('#cc-submit').show();
                    console.log(response.error);
                    return $('#errors').html(response.error);
                case 402:
                    $('#cc-submit').show();
                    console.log(response.error);
                    return $('#errors').html(response.error);
                case 404:
                    $('#cc-submit').show();
                    console.log(response.error);
                    return $('#errors').html(response.error);
                case 500:
                    $(e.target).show();
                    return 'poop';
            }
        };

        $('#cc-submit').click(function(e) {
            var $form, creditCardData;
            $(e.target).hide();
            e.preventDefault();
            $('#errors').html();
            $form = $('#credit-card-form');
            creditCardData = {
                card_number: $form.find('#cc-number').val(),
                expiration_month: $form.find('#cc-ex-month').val(),
                expiration_year: $form.find('#cc-ex-year').val(),
                security_code: $form.find('#cc-csc').val()
            };
            return balanced.card.create(creditCardData, callbackHandler);
        });

    </script>
{% endblock %}